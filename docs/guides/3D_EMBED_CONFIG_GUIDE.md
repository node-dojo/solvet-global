# 3D Embed Configuration Guide

## Overview

The NO3D Tools website now has a complete 3D viewer configuration system that allows you to customize how 3D models appear in product card carousels. This system uses JSON config files that are generated by the **3D Embed Utility** tool and automatically applied by the website's product carousel.

## How It Works

### 1. Config File Generation

Use the [3D Embed Utility](no3d-tools-website/3d-viewer/3d-embed-utility.html) to:
- Load a 3D model (STL, GLB, OBJ, etc.)
- Adjust visual settings (camera, lighting, materials, effects)
- Preview the exact appearance
- Export a `3d-embed-config.json` file

### 2. Config File Storage

The config file should be placed in the product's **card assets** folder:

```
no3d-tools-library/
  └── [Product Name]/
      └── [Product Name] card assets/
          ├── 3d-embed-config.json    ← Config file here
          ├── bolt thumb.stl           ← 3D model file
          └── preview-embed.html       ← (optional) custom embed
```

### 3. Automatic Application

When a user views a product on the website:
1. Website loads the product's card assets folder from GitHub
2. Finds any 3D model files (`.stl`, `.glb`, `.obj`, etc.)
3. Looks for `3d-embed-config.json` in the same folder
4. Generates a THREE.js embed using the config settings
5. Displays the embed in the product carousel

## Config File Structure

### Complete Example

```json
{
  "enabled": true,
  "viewer": {
    "width": "100%",
    "height": "100%",
    "maxWidth": "100%",
    "usePixels": false,
    "maintainAspect": true,
    "aspectRatio": "1:1"
  },
  "embed": {
    "backgroundColor": "transparent",
    "backgroundOpacity": 0,
    "transparentBackground": true,
    "interactionMode": "full",
    "enableAR": false,
    "loadingStrategy": "auto",
    "revealStrategy": "auto"
  },
  "camera": {
    "fieldOfView": "90deg",
    "exposure": "1.0",
    "cameraControls": true,
    "autoRotate": true,
    "rotationSpeed": "0.3deg",
    "cameraOrbit": "0deg 75deg 0.9m",
    "cameraDistance": 0.9,
    "modelFill": 0.55
  },
  "performance": {
    "renderQuality": "auto",
    "enableShadows": false,
    "shadowIntensity": "0",
    "enableToneMapping": true,
    "toneMapping": "auto"
  },
  "model": {
    "scale": "1 1 1"
  },
  "material": {
    "metalness": 0.3,
    "roughness": 0.4,
    "color": "#888888"
  },
  "lighting": {
    "hemisphere": {
      "enabled": true,
      "skyColor": "#ffffff",
      "groundColor": "#444444",
      "intensity": 0.6
    },
    "key": {
      "enabled": true,
      "color": "#ffffff",
      "intensity": 0.8,
      "position": { "x": 5, "y": 10, "z": 7 }
    },
    "fill": {
      "enabled": true,
      "color": "#8888ff",
      "intensity": 0.4,
      "position": { "x": -5, "y": 5, "z": 5 }
    },
    "rim": {
      "enabled": true,
      "color": "#ffffff",
      "intensity": 0.5,
      "position": { "x": 0, "y": 3, "z": -10 }
    },
    "ambient": {
      "enabled": true,
      "color": "#404040",
      "intensity": 0.2
    }
  },
  "display": {
    "sketchMode": {
      "enabled": false,
      "lineDensity": 0.3,
      "lineWidth": 1,
      "intensity": 1,
      "noiseScale": 1
    }
  }
}
```

## Configuration Sections

### 1. Viewer Settings

Controls the viewer container size and aspect ratio:

```json
"viewer": {
  "width": "100%",           // Width of viewer container
  "height": "100%",          // Height (ignored if maintainAspect is true)
  "maxWidth": "100%",        // Maximum width
  "usePixels": false,        // Use pixels instead of percentages
  "maintainAspect": true,    // Maintain aspect ratio
  "aspectRatio": "1:1"       // Aspect ratio (1:1, 16:9, 4:3, etc.)
}
```

### 2. Embed Settings

Controls background and interaction:

```json
"embed": {
  "backgroundColor": "transparent",  // Background color or "transparent"
  "backgroundOpacity": 0,            // 0-1 opacity
  "transparentBackground": true,     // Enable alpha channel
  "interactionMode": "full",         // User interaction level
  "enableAR": false,                 // AR mode (GLB/GLTF only)
  "loadingStrategy": "auto",         // How to load the model
  "revealStrategy": "auto"           // How to reveal the model
}
```

### 3. Camera Settings

**NEW**: Now includes `modelFill` and `cameraDistance`:

```json
"camera": {
  "fieldOfView": "90deg",        // Field of view (wider = more visible)
  "exposure": "1.0",             // Exposure value
  "cameraControls": true,        // Enable orbit controls
  "autoRotate": true,            // Auto-rotation
  "rotationSpeed": "0.3deg",     // Rotation speed
  "cameraOrbit": "0deg 75deg 0.9m",  // Initial camera position
  "cameraDistance": 0.9,         // Exact camera distance (overrides orbit)
  "modelFill": 0.55              // How much of frame model fills (0.3-1.5)
}
```

**Model Fill Explained**:
- `modelFill: 0.3` → Model fills MORE of the frame (camera closer)
- `modelFill: 1.0` → Default framing
- `modelFill: 1.5` → Model fills LESS of the frame (camera further)

### 4. Material Settings

**NEW**: Control the 3D model's material appearance:

```json
"material": {
  "metalness": 0.3,    // 0 = non-metallic, 1 = fully metallic
  "roughness": 0.4,    // 0 = smooth/shiny, 1 = rough/matte
  "color": "#888888"   // Base color in hex
}
```

### 5. Lighting Settings

**NEW**: Full 3-point lighting system:

```json
"lighting": {
  "hemisphere": {
    "enabled": true,
    "skyColor": "#ffffff",     // Top hemisphere color
    "groundColor": "#444444",  // Bottom hemisphere color
    "intensity": 0.6           // Light intensity
  },
  "ambient": {
    "enabled": true,
    "color": "#404040",        // Ambient light color
    "intensity": 0.2           // Light intensity
  },
  "key": {
    "enabled": true,
    "color": "#ffffff",        // Main light color
    "intensity": 0.8,          // Light intensity
    "position": {              // Light position in 3D space
      "x": 5,
      "y": 10,
      "z": 7
    }
  },
  "fill": {
    "enabled": true,
    "color": "#8888ff",        // Fill light (softens shadows)
    "intensity": 0.4,
    "position": { "x": -5, "y": 5, "z": 5 }
  },
  "rim": {
    "enabled": true,
    "color": "#ffffff",        // Rim/back light (edge definition)
    "intensity": 0.5,
    "position": { "x": 0, "y": 3, "z": -10 }
  }
}
```

### 6. Display Effects

**NEW**: Sketch mode post-processing effect:

```json
"display": {
  "sketchMode": {
    "enabled": false,      // Enable sketch effect
    "lineDensity": 0.3,    // How many sketch lines (0-1)
    "lineWidth": 1,        // Width of sketch lines
    "intensity": 1,        // Effect strength (0-1)
    "noiseScale": 1        // Randomness of lines
  }
}
```

### 7. Performance Settings

```json
"performance": {
  "renderQuality": "auto",      // "auto", "high", "low"
  "enableShadows": false,       // Enable shadow rendering
  "shadowIntensity": "0",       // Shadow darkness
  "enableToneMapping": true,    // Better color rendering
  "toneMapping": "auto"         // Tone mapping algorithm
}
```

### 8. Model Settings

```json
"model": {
  "scale": "1 1 1"    // X Y Z scale factors
}
```

## Workflow

### For Each Product:

1. **Create/Find 3D Model**
   - Export model as `.stl`, `.glb`, or `.obj`
   - Place in `[Product Name] card assets/` folder

2. **Configure Appearance**
   - Open [3d-embed-utility.html](no3d-tools-website/3d-viewer/3d-embed-utility.html)
   - Load the 3D model
   - Adjust:
     - Camera position & FOV
     - Model fill (how much space it occupies)
     - Material (metalness, roughness, color)
     - Lighting (3-point lighting setup)
     - Effects (sketch mode, shadows)
   - Preview the result in real-time

3. **Export Config**
   - Click "Preview & Get Embed Code"
   - Click "Download Config JSON"
   - Save as `3d-embed-config.json`

4. **Deploy to GitHub**
   - Place `3d-embed-config.json` in the card assets folder
   - Commit and push to the repository
   - Website will automatically use the config

## File Locations

- **3D Embed Utility**: `no3d-tools-website/3d-viewer/3d-embed-utility.html`
- **Product Card Script**: `no3d-tools-website/script.js` (lines 1481-1926)
- **Config Loading**: `no3d-tools-website/script.js` (lines 1963-1985)
- **Embed Generation**: `no3d-tools-website/script.js` (lines 2030-2047)
- **Example Config**: `no3d-tools-library/Dojo Bolt Gen v05/Dojo Bolt Gen v05 card assets/3d-embed-config.json`

## Troubleshooting

### Config not loading?
- Check file name is exactly `3d-embed-config.json`
- Verify file is in the correct folder: `[Product Name]/[Product Name] card assets/`
- Check JSON syntax is valid
- Ensure file is committed and pushed to GitHub

### 3D model not appearing?
- Verify model file is in card assets folder
- Check file extension is supported: `.stl`, `.glb`, `.obj`
- Look in browser console for loading errors

### Wrong appearance?
- Verify config values match your 3D Embed Utility preview
- Check `enabled: true` in config
- Try disabling sketch mode if it's enabled
- Verify lighting values are reasonable (0-1 for intensity)

## Technical Details

### Supported File Formats

- **STL**: Three.js with custom material/lighting (full config support)
- **GLB/GLTF**: model-viewer (basic config support)
- **OBJ**: Three.js with custom material/lighting (full config support)

### Config Priority

1. If `3d-embed-config.json` exists → use it
2. Otherwise → use default config with basic lighting

### Default Config

If no config file is found, this default is used:

```json
{
  "enabled": true,
  "viewer": { "width": "100%", "aspectRatio": "1:1" },
  "camera": { "fieldOfView": "45deg", "autoRotate": false },
  "material": { "metalness": 0.3, "roughness": 0.4, "color": "#888888" },
  "lighting": {
    "hemisphere": { "enabled": true, "intensity": 0.6 },
    "key": { "enabled": true, "intensity": 0.8 }
  }
}
```

## Updates from Previous Version

### What's New:
- ✅ **Model Fill Control**: Adjust how much of the frame the model occupies
- ✅ **Camera Distance**: Set exact camera distance
- ✅ **Material Properties**: Control metalness, roughness, and color
- ✅ **Full Lighting System**: Hemisphere, ambient, key, fill, and rim lights
- ✅ **Sketch Mode**: Post-processing effect for hand-drawn appearance
- ✅ **Transparent Backgrounds**: Full alpha channel support

### Breaking Changes:
- None! Old config files will still work with default values for new properties.
